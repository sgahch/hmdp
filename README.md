# é»‘é©¬ç‚¹è¯„ (HMDP) - æœ¬åœ°ç”Ÿæ´»æœåŠ¡å¹³å°

> åŸºäºSpring Boot + Redisçš„é«˜æ€§èƒ½æœ¬åœ°ç”Ÿæ´»æœåŠ¡å¹³å°ï¼Œç±»ä¼¼å¤§ä¼—ç‚¹è¯„çš„åŠŸèƒ½å®ç°

![GitHub è´¡çŒ®è´ªåƒè›‡](https://raw.githubusercontent.com/yuaotian/yuaotian/refs/heads/output/github-contribution-grid-snake.svg)
## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

é»‘é©¬ç‚¹è¯„æ˜¯ä¸€ä¸ªå®Œæ•´çš„æœ¬åœ°ç”Ÿæ´»æœåŠ¡å¹³å°ï¼Œæä¾›å•†é“ºæŸ¥è¯¢ã€ä¼˜æƒ åˆ¸ç§’æ€ã€ç”¨æˆ·ç¤¾äº¤ã€åšå®¢åˆ†äº«ç­‰åŠŸèƒ½ã€‚é¡¹ç›®é‡ç‚¹å±•ç¤ºäº†Redisåœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­çš„åº”ç”¨ï¼ŒåŒ…æ‹¬ç¼“å­˜ç­–ç•¥ã€åˆ†å¸ƒå¼é”ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰é«˜çº§ç‰¹æ€§ã€‚

### ğŸ› ï¸ æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| **åç«¯æ¡†æ¶** | | |
| Spring Boot | 2.7.4 | ä¸»æ¡†æ¶ |
| MyBatis Plus | 3.5.2 | ORMæ¡†æ¶ |
| **æ•°æ®å­˜å‚¨** | | |
| MySQL | 8.0+ | å…³ç³»å‹æ•°æ®åº“ |
| Redis | 6.0+ | ç¼“å­˜æ•°æ®åº“ |
| **å·¥å…·åº“** | | |
| Hutool | 5.8.8 | Javaå·¥å…·åº“ |
| Redisson | 3.17.7 | Redisåˆ†å¸ƒå¼é” |
| Lombok | 1.18.30 | ä»£ç ç®€åŒ– |

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

#### 1. ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ
- **æ‰‹æœºéªŒè¯ç ç™»å½•**: åŸºäºRedisçš„éªŒè¯ç å­˜å‚¨å’Œæ ¡éªŒ
- **ç”¨æˆ·ä¿¡æ¯ç®¡ç†**: ç”¨æˆ·èµ„æ–™ã€å¤´åƒä¸Šä¼ 
- **ç­¾åˆ°ç³»ç»Ÿ**: åŸºäºRedis BitMapçš„è¿ç»­ç­¾åˆ°ç»Ÿè®¡

#### 2. å•†é“ºç®¡ç†ç³»ç»Ÿ
- **å•†é“ºä¿¡æ¯æŸ¥è¯¢**: æ”¯æŒåˆ†ç±»ã€åœ°ç†ä½ç½®æŸ¥è¯¢
- **ç¼“å­˜ç­–ç•¥**:
  - ç¼“å­˜ç©¿é€è§£å†³æ–¹æ¡ˆï¼ˆç©ºå€¼ç¼“å­˜ï¼‰
  - ç¼“å­˜é›ªå´©è§£å†³æ–¹æ¡ˆï¼ˆTTLéšæœºåŒ–ï¼‰
  - ç¼“å­˜å‡»ç©¿è§£å†³æ–¹æ¡ˆï¼ˆäº’æ–¥é”ã€é€»è¾‘è¿‡æœŸï¼‰

#### 3. ä¼˜æƒ åˆ¸ç§’æ€ç³»ç»Ÿ
- **ç§’æ€åŠŸèƒ½**: é«˜å¹¶å‘ç§’æ€ä¼˜æƒ åˆ¸
- **åˆ†å¸ƒå¼é”**: åŸºäºRedisçš„åˆ†å¸ƒå¼é”é˜²æ­¢è¶…å–
- **å¼‚æ­¥å¤„ç†**: Luaè„šæœ¬ + æ¶ˆæ¯é˜Ÿåˆ—ä¼˜åŒ–æ€§èƒ½
- **ä¸€äººä¸€å•**: é˜²æ­¢ç”¨æˆ·é‡å¤ä¸‹å•

#### 4. åšå®¢ç¤¾äº¤ç³»ç»Ÿ
- **åšå®¢å‘å¸ƒ**: ç”¨æˆ·å¯å‘å¸ƒå›¾æ–‡åšå®¢
- **ç‚¹èµåŠŸèƒ½**: åŸºäºRedis ZSetçš„ç‚¹èµæ’è¡Œæ¦œ
- **å…³æ³¨ç³»ç»Ÿ**: ç”¨æˆ·å…³æ³¨/å–å…³ï¼Œå…±åŒå…³æ³¨æŸ¥è¯¢
- **Feedæµ**: åŸºäºæ¨æ¨¡å¼çš„å…³æ³¨ç”¨æˆ·åšå®¢æ¨é€

#### 5. åœ°ç†ä½ç½®æœåŠ¡
- **é™„è¿‘å•†é“º**: åŸºäºRedis GEOçš„åœ°ç†ä½ç½®æŸ¥è¯¢
- **è·ç¦»è®¡ç®—**: è‡ªåŠ¨è®¡ç®—ç”¨æˆ·ä¸å•†é“ºçš„è·ç¦»

## ğŸ“ é¡¹ç›®ç»“æ„

```
hmdp/
â”œâ”€â”€ src/main/java/com/hmdp/
â”‚   â”œâ”€â”€ HmDianPingApplication.java          # å¯åŠ¨ç±»
â”‚   â”œâ”€â”€ config/                             # é…ç½®ç±»
â”‚   â”‚   â”œâ”€â”€ MvcConfig.java                  # MVCé…ç½®
â”‚   â”‚   â”œâ”€â”€ MybatisConfig.java              # MyBatisé…ç½®
â”‚   â”‚   â”œâ”€â”€ RedissonConfig.java             # Redissoné…ç½®
â”‚   â”‚   â””â”€â”€ WebExceptionAdvice.java         # å…¨å±€å¼‚å¸¸å¤„ç†
â”‚   â”œâ”€â”€ controller/                         # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”œâ”€â”€ BlogController.java             # åšå®¢æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ FollowController.java           # å…³æ³¨æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ ShopController.java             # å•†é“ºæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ UserController.java             # ç”¨æˆ·æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ VoucherController.java          # ä¼˜æƒ åˆ¸æ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ VoucherOrderController.java     # è®¢å•æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ dto/                                # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”œâ”€â”€ LoginFormDTO.java               # ç™»å½•è¡¨å•
â”‚   â”‚   â”œâ”€â”€ Result.java                     # ç»Ÿä¸€è¿”å›ç»“æœ
â”‚   â”‚   â”œâ”€â”€ ScrollResult.java               # æ»šåŠ¨åˆ†é¡µç»“æœ
â”‚   â”‚   â””â”€â”€ UserDTO.java                    # ç”¨æˆ·ä¿¡æ¯
â”‚   â”œâ”€â”€ entity/                             # å®ä½“ç±»
â”‚   â”‚   â”œâ”€â”€ Blog.java                       # åšå®¢å®ä½“
â”‚   â”‚   â”œâ”€â”€ Follow.java                     # å…³æ³¨å…³ç³»
â”‚   â”‚   â”œâ”€â”€ Shop.java                       # å•†é“ºå®ä½“
â”‚   â”‚   â”œâ”€â”€ User.java                       # ç”¨æˆ·å®ä½“
â”‚   â”‚   â”œâ”€â”€ Voucher.java                    # ä¼˜æƒ åˆ¸å®ä½“
â”‚   â”‚   â””â”€â”€ VoucherOrder.java               # è®¢å•å®ä½“
â”‚   â”œâ”€â”€ interceptor/                        # æ‹¦æˆªå™¨
â”‚   â”‚   â”œâ”€â”€ LoginInterceptor.java           # ç™»å½•æ‹¦æˆªå™¨
â”‚   â”‚   â””â”€â”€ RefreshTokenInterceptor.java    # Tokenåˆ·æ–°æ‹¦æˆªå™¨
â”‚   â”œâ”€â”€ mapper/                             # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ BlogMapper.java                 # åšå®¢Mapper
â”‚   â”‚   â”œâ”€â”€ ShopMapper.java                 # å•†é“ºMapper
â”‚   â”‚   â”œâ”€â”€ UserMapper.java                 # ç”¨æˆ·Mapper
â”‚   â”‚   â””â”€â”€ VoucherOrderMapper.java         # è®¢å•Mapper
â”‚   â”œâ”€â”€ service/                            # æœåŠ¡æ¥å£å±‚
â”‚   â”‚   â”œâ”€â”€ IBlogService.java               # åšå®¢æœåŠ¡æ¥å£
â”‚   â”‚   â”œâ”€â”€ IShopService.java               # å•†é“ºæœåŠ¡æ¥å£
â”‚   â”‚   â”œâ”€â”€ IUserService.java               # ç”¨æˆ·æœåŠ¡æ¥å£
â”‚   â”‚   â””â”€â”€ IVoucherOrderService.java       # è®¢å•æœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ service/impl/                       # æœåŠ¡å®ç°å±‚
â”‚   â”‚   â”œâ”€â”€ BlogServiceImpl.java            # åšå®¢æœåŠ¡å®ç°
â”‚   â”‚   â”œâ”€â”€ ShopServiceImpl.java            # å•†é“ºæœåŠ¡å®ç°
â”‚   â”‚   â”œâ”€â”€ UserServiceImpl.java            # ç”¨æˆ·æœåŠ¡å®ç°
â”‚   â”‚   â””â”€â”€ VoucherOrderServiceImpl.java    # è®¢å•æœåŠ¡å®ç°
â”‚   â””â”€â”€ utils/                              # å·¥å…·ç±»
â”‚       â”œâ”€â”€ CacheClient.java                # ç¼“å­˜å·¥å…·ç±»
â”‚       â”œâ”€â”€ ILock.java                      # åˆ†å¸ƒå¼é”æ¥å£
â”‚       â”œâ”€â”€ SimpleRedisLock.java            # Redisåˆ†å¸ƒå¼é”å®ç°
â”‚       â”œâ”€â”€ RedisIdWorker.java              # Redis IDç”Ÿæˆå™¨
â”‚       â”œâ”€â”€ RedisConstants.java             # Rediså¸¸é‡
â”‚       â””â”€â”€ UserHolder.java                 # ç”¨æˆ·ä¸Šä¸‹æ–‡
â”œâ”€â”€ src/main/resources/
â”‚   â”œâ”€â”€ application.yaml                    # åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ mapper/                             # MyBatisæ˜ å°„æ–‡ä»¶
â”‚   â”œâ”€â”€ seckill.lua                         # ç§’æ€Luaè„šæœ¬
â”‚   â””â”€â”€ unlock.lua                          # è§£é”Luaè„šæœ¬
â”œâ”€â”€ hmdp.sql                                # æ•°æ®åº“è„šæœ¬
â””â”€â”€ pom.xml                                 # Mavené…ç½®
```

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### ç¯å¢ƒè¦æ±‚
- JDK 11+
- Maven 3.6+
- MySQL 8.0+
- Redis 6.0+

### å¯åŠ¨æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <repository-url>
cd hmdp
```

2. **æ•°æ®åº“åˆå§‹åŒ–**
```bash
# åˆ›å»ºæ•°æ®åº“
mysql -u root -p
CREATE DATABASE hmdp;

# å¯¼å…¥æ•°æ®
mysql -u root -p hmdp < hmdp.sql
```

3. **é…ç½®æ–‡ä»¶**
ä¿®æ”¹ `src/main/resources/application.yaml`:
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/hmdp
    username: your_username
    password: your_password
  redis:
    host: localhost
    port: 6379
    password: your_redis_password  # å¦‚æœæœ‰å¯†ç 
```

4. **å¯åŠ¨Redis**
```bash
redis-server
```

5. **è¿è¡Œé¡¹ç›®**
```bash
mvn spring-boot:run
```

6. **è®¿é—®åº”ç”¨**
- åç«¯API: http://localhost:8081
- æ¥å£æ–‡æ¡£: æŸ¥çœ‹å„Controllerç±»çš„æ¥å£å®šä¹‰

## ğŸ”§ æ ¸å¿ƒæŠ€æœ¯ç‰¹æ€§

### Redisåº”ç”¨åœºæ™¯

| åŠŸèƒ½ | Redisæ•°æ®ç»“æ„ | åº”ç”¨åœºæ™¯ |
|------|---------------|----------|
| ç”¨æˆ·ç™»å½• | String | å­˜å‚¨éªŒè¯ç å’Œç”¨æˆ·Token |
| å•†é“ºç¼“å­˜ | String | ç¼“å­˜å•†é“ºä¿¡æ¯ï¼Œè§£å†³ç¼“å­˜ç©¿é€/å‡»ç©¿/é›ªå´© |
| ç‚¹èµæ’è¡Œ | ZSet | åšå®¢ç‚¹èµç”¨æˆ·æ’åº |
| å…³æ³¨åˆ—è¡¨ | Set | å­˜å‚¨ç”¨æˆ·å…³æ³¨å…³ç³»ï¼Œè®¡ç®—å…±åŒå…³æ³¨ |
| ç­¾åˆ°ç»Ÿè®¡ | BitMap | ç”¨æˆ·è¿ç»­ç­¾åˆ°å¤©æ•°ç»Ÿè®¡ |
| é™„è¿‘å•†é“º | GEO | åœ°ç†ä½ç½®æŸ¥è¯¢ |
| ç§’æ€åº“å­˜ | String + Lua | åŸå­æ€§åº“å­˜æ‰£å‡ |
| åˆ†å¸ƒå¼é” | String + Lua | é˜²æ­¢å¹¶å‘é—®é¢˜ |
| Feedæµ | ZSet | å…³æ³¨ç”¨æˆ·åšå®¢æ—¶é—´çº¿ |

### åˆ†å¸ƒå¼é”å®ç°
- åŸºäºRedisçš„SET NX EXå‘½ä»¤
- Luaè„šæœ¬ä¿è¯åŸå­æ€§
- è‡ªåŠ¨ç»­æœŸæœºåˆ¶ï¼ˆRedissonï¼‰
- é˜²æ­¢é”è¯¯åˆ é™¤

### ç¼“å­˜ç­–ç•¥
- **ç¼“å­˜ç©¿é€**: ç©ºå€¼ç¼“å­˜ + å¸ƒéš†è¿‡æ»¤å™¨
- **ç¼“å­˜å‡»ç©¿**: äº’æ–¥é” + é€»è¾‘è¿‡æœŸ
- **ç¼“å­˜é›ªå´©**: TTLéšæœºåŒ– + å¤šçº§ç¼“å­˜

## ğŸ“š å­¦ä¹ èµ„æº

æœ¬é¡¹ç›®æ¥è‡ªé»‘é©¬ç¨‹åºå‘˜Redisæ•™ç¨‹ï¼Œä»…ä¾›å­¦ä¹ å‚è€ƒï¼š
- è§†é¢‘æ•™ç¨‹: [Rediså…¥é—¨åˆ°å®æˆ˜](https://www.bilibili.com/video/BV1cr4y1671t)
- å®æˆ˜ç¯‡ä»P24å¼€å§‹

### é¡¹ç›®åˆ†æ”¯è¯´æ˜
- **master**: å®Œæ•´ç‰ˆä»£ç ï¼ŒåŒ…å«æ‰€æœ‰åŠŸèƒ½å®ç°
- **init**: åˆå§‹åŒ–ä»£ç ï¼Œé€‚åˆè·Ÿç€æ•™ç¨‹å­¦ä¹ å¼€å‘

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒåŸæ•™ç¨‹æˆ–æäº¤Issueã€‚

## 1.ä¸‹è½½
å…‹éš†å®Œæ•´é¡¹ç›®
```git
git clone https://github.com/sgahch/hmdp.git
```
åˆ‡æ¢åˆ†æ”¯
```git
git checkout init
```

## 2.å¸¸è§é—®é¢˜
éƒ¨åˆ†åŒå­¦ç›´æ¥ä½¿ç”¨äº†masteråˆ†æ”¯é¡¹ç›®æ¥å¯åŠ¨ï¼Œæ§åˆ¶å°ä¼šä¸€ç›´æŠ¥é”™:
```
NOGROUP No such key 'stream.orders' or consumer group 'g1' in XREADGROUP with GROUP option
```
è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å®Œæ•´ç‰ˆä»£ç ä¼šå°è¯•è®¿é—®Redisï¼Œè¿æ¥Redisçš„Streamã€‚å»ºè®®åŒå­¦åˆ‡æ¢åˆ°initåˆ†æ”¯æ¥å¼€å‘ï¼Œå¦‚æœä¸€å®šè¦è¿è¡Œmasteråˆ†æ”¯ï¼Œè¯·å…ˆåœ¨Redisè¿è¡Œä¸€ä¸‹å‘½ä»¤ï¼š
```text
XGROUP CREATE stream.orders g1 $ MKSTREAM
```
